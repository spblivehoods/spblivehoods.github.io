"use strict";!function(i,t){"function"==typeof define&&define.amd?define(["leaflet"],i):"object"==typeof exports&&(module.exports=i(require("leaflet"))),void 0!==t&&t.L&&(t.L.CanvasIconLayer=i(L))}(function(i){var t=(i.Layer?i.Layer:i.Class).extend({initialize:function(t){i.setOptions(this,t)},setOptions:function(t){return i.setOptions(this,t),this._canvas&&this._updateOptions(),this.redraw()},redraw:function(){this._redraw(!0)},addMarker:function(t){i.Util.stamp(t),this._markers||(this._markers={}),this._markers[t._leaflet_id]=t,this._drawMarker(t)},addLayer:function(i){"markerPane"==i.options.pane&&i.options.icon?this.addMarker(i):console.error("Layer isn't a marker")},removeLayer:function(i){this.removeMarker(i,!0)},removeMarker:function(i,t){delete this._markers[i._leaflet_id],t&&this._redraw(!0)},onAdd:function(i){this._map=i,this._onClickListeners=[],this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):i._panes.overlayPane.appendChild(this._canvas),i.on("moveend",this._reset,this),i.on("click",this._executeClickListeners,this)},onRemove:function(i){this.options.pane?this.getPane().removeChild(this._canvas):i.getPanes().overlayPane.removeChild(this._canvas)},addTo:function(i){return i.addLayer(this),this},_drawMarker:function(i){var t=this,n=this._map.latLngToContainerPoint(i.getLatLng());i.canvas_img?t._drawImage(i,n):(i.canvas_img=new Image,i.canvas_img.src=i.options.icon.options.iconUrl,i.canvas_img.onload=function(){t._drawImage(i,n)})},_drawImage:function(i,t){this._context.drawImage(i.canvas_img,t.x-i.options.icon.options.iconAnchor[0],t.y-i.options.icon.options.iconAnchor[1],i.options.icon.options.iconSize[0],i.options.icon.options.iconSize[1])},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);i.DomUtil.setPosition(this._canvas,t);var n=this._map.getSize();this._canvas.width=n.x,this._canvas.height=n.y,this._redraw()},_redraw:function(i){this._map&&(i&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height),Object.keys(this._markers).forEach(function(i){this._drawMarker(this._markers[i])},this))},_initCanvas:function(){this._canvas=i.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer");var t=i.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[t]="50% 50%";var n=this._map.getSize();this._canvas.width=n.x,this._canvas.height=n.y,this._context=this._canvas.getContext("2d");var a=this._map.options.zoomAnimation&&i.Browser.any3d;i.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(a?"animated":"hide"))},_updateOptions:function(){},addOnClickListener:function(i){this._onClickListeners.push(i)},_executeClickListeners:function(i){for(var t in this._markers){var n=this._markers[t],a=this._map.latLngToContainerPoint(this._markers[t].getLatLng());if(this._hit(n,a,i)){this._onClickListeners.forEach(function(t){t(i)});break}}},_hit:function(i,t,n){var a=i.options.icon.options.iconSize[0]/2,e=i.options.icon.options.iconSize[1]/2,s=n.containerPoint.x,o=n.containerPoint.y;return s<=t.x+a&&s>=t.x-a&&o>=t.y-e&&o<=t.y+e}});i.canvasIconLayer=function(i){return new t(i)}},window);